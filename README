README

This is the software pipeline written by Xochitl Morgan (morganx@gmail.com) to calculate
coverage of genes within strains for Chthonomonas calidirosea. It performs the following steps:

1. make_protein_bam.sh 
This shell script creates bowtie2 indices for each strain, then  uses bowtie2 to align reads 
for each strain, in each genome. The inputs are nucleotide fasta files for genes,
and fastq files for reads.

The fastq files are not included in the bitbucket repository, but are available
for download at https://drive.google.com/folderview?id=0BxCxomZqt5ykbGF6MnVEbS1rc2s&usp=sharing

You will need to create a subdirectory called "bams" in the folder "Chthonomonas" and put the fastq files there. 

How to run:

sh make_protein_bam.sh


2. feature_bed.pl

This perl script generates a bed file for each strain,  in which the features are the 
strain's genes. The inputs are the nucleotide fasta files for the strain, and the
outputs are a bed file for each strain. 

How to run: 

perl feature_bed.pl

3. parse-protein-bams.sh
This step compiles the per-position coverage for each gene, then pipes the output through
the parse_coverage script, which calculates the median and standard deviation per gene. 
The inputs are the bam files created in step 1, and bed files created in step 2. The outputs
 are one file per genome (strain.cov), summarizing the per-gene median and standard deviation coverage.
 
 How to run:
 
 sh parse-protein-bams.sh

4. collate_coverage.pl
This reformats the four output files produced in step 3 into an Excel-friendly table.

How to run:

perl collate_coverage.pl > table

5. index.pl
This attaches a strain label to each gene identifier the table produced in step 4, so
it is easier to tell which gene belongs to which strain. 

How to run:

perl index.pl table > indexed-table

Prerequisites:

Bowtie2, bedtools, perl Math::NumberCruncher

6. do_uclust.sh
This shell script makes the annotated genes into 95% identity clusters with uclust.

How to run:
Make sure that all.fna.gz (available in Downloads) is downloaded and in the same directory
sh do_uclust.sh

Prerequisites: usearch

Note: You will almost certainly have to edit this shell script to match your version of usearch

7. parse_uparse.pl

This perl script simplifies and filters each gene as present / absent in each genome based on whether it met the IQR-based threshold. It also combines the filtered output with the uclust gene clusters, producing a table that shows both which highly similar genes were annotated in each genome, and in which genomes these are well-supported by read coverage.






##################################
This bitbucket repository also contains operon.py, which was used for operon dispersal analysis, and dataset.txt, which 
is the collection of input genes used for the operon dispersal analysis.